{% extends "base.html" %}

{% block content %}
<h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Manage Hostel Structure</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- Add Block Form -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold text-gray-700 mb-4">Add a New Block</h3>
        <form action="{{ url_for('build') }}" method="POST">
            <input type="hidden" name="action" value="add_block">
            <div class="mb-4">
                <label for="block_name" class="block text-gray-700 font-semibold mb-2">Block Name</label>
                <input type="text" id="block_name" name="block_name" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Add Block</button>
        </form>
    </div>

    <!-- Add Room Form -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold text-gray-700 mb-4">Add a New Room</h3>
        <form action="{{ url_for('build') }}" method="POST">
            <input type="hidden" name="action" value="add_room">
            <div class="mb-4">
                <label for="block_id" class="block text-gray-700 font-semibold mb-2">Select Block</label>
                <select id="block_id" name="block_id" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    {% for block in blocks %}
                        <option value="{{ block.id }}">{{ block.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-4">
                <label for="room_name" class="block text-gray-700 font-semibold mb-2">Room Name</label>
                <input type="text" id="room_name" name="room_name" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div class="mb-4">
                <label for="bed_count" class="block text-gray-700 font-semibold mb-2">Number of Beds</label>
                <input type="number" id="bed_count" name="bed_count" min="1" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Add Room</button>
        </form>
    </div>

    <!-- Add Person to Bed Form -->
    <div class="bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold text-gray-700 mb-4">Assign a Person to a Bed</h3>
        <form action="{{ url_for('build') }}" method="POST">
            <input type="hidden" name="action" value="add_person">
            <div class="mb-4">
                <label for="bed_id" class="block text-gray-700 font-semibold mb-2">Select Bed</label>
                <select id="bed_id" name="bed_id" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    {% for block in blocks %}
                        {% for room in block.rooms %}
                            {% for bed in room.beds %}
                                {% if not bed.is_occupied %}
                                    <option value="{{ bed.id }}">Block {{ block.name }} - Room {{ room.name }} - Bed {{ bed.bed_number }}</option>
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>
            <div class="mb-4">
                <label for="person_name" class="block text-gray-700 font-semibold mb-2">Person Name</label>
                <input type="text" id="person_name" name="person_name" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div class="mb-4">
                <label for="aadhar" class="block text-gray-700 font-semibold mb-2">Mobile Number</label>
                <input type="text" id="aadhar" name="aadhar" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div class="mb-4">
                <label for="joining_date" class="block text-gray-700 font-semibold mb-2">Joining Date</label>
                <input type="date" id="joining_date" name="joining_date" class="w-full border rounded-lg py-2 px-3 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">Assign Person</button>
        </form>
    </div>
</div>

<!-- Hostel Structure View -->
<div class="mt-8 bg-white p-6 rounded-xl shadow-lg">
    <h3 class="text-xl font-bold text-gray-700 mb-4">Current Hostel Structure</h3>
    {% for block in blocks %}
        <div class="mb-6 p-4 border rounded-lg bg-gray-50">
            <h4 class="text-lg font-bold text-gray-800">{{ block.name }}</h4>
            {% for room in block.rooms %}
                <div class="ml-4 mt-2 p-3 border-l-2 border-blue-500">
                    <div style="display: flex; justify-content: space-between;">
                        <h5 class="font-semibold text-gray-700">Room {{ room.name }} ({{ room.bed_count }} beds)</h5>
                        <form action="{{ url_for('delete_room', room_id=room.id) }}" method="post">
                            <button type="submit" style="background-color: red; border-radius: 5px; color: white; padding:7px 10px;">Delete</button>
                        </form>
                    </div>

                    <ul class="ml-4 mt-2 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        {% for bed in room.beds %}
                            <li class="bg-gray-200 p-4 rounded-lg flex flex-col justify-between shadow-sm border border-gray-300">
                                <span class="font-medium">Bed #{{ bed.bed_number }}</span>
                                <span class="text-sm font-semibold mt-1">Status: <span class="{% if bed.is_occupied %}text-red-600{% else %}text-green-600{% endif %}">
                                    {{ 'Occupied' if bed.is_occupied else 'Empty' }}
                                </span></span>
                                {% if bed.person %}
                                    <div class="mt-2 text-sm text-gray-600 border-t border-gray-400 pt-2">
                                        <p>Name: {{ bed.person.name }}</p>
                                        <p>Joined: {{ bed.person.joining_date }}</p>
                                    </div>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>
{% endblock %}
